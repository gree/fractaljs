!function(a){var b=function(){function a(a){if(a.source==window&&a.data==c&&(a.stopPropagation(),b.length>0)){var d=b.shift();d()}}var b=[],c=(new Date).getTime();return window.addEventListener("message",a,!0),function(a){b.push(a),window.postMessage(c,"*")}}(),c=function(a,b,c){var d,e;if(d=e=a.length)for(;d;)b(a[--d],function(){--e||c()});else c()},d=function(){var a={};return function(b,c,d){b in a?a[b].push(d):(a[b]=[d],c(function(c){var d=a[b],e=d.length;for(delete a[b];e;)c(d[--e])}))}},e=function(a){var b=!1,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,d=function(){};return d.extend=function(d){var e=this.prototype;b=!0;var f=new this;b=!1;for(var g in d)f[g]="function"==typeof d[g]&&"function"==typeof e[g]&&c.test(d[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,d[g]):d[g];var h=function(){!b&&this.init&&this.init.apply(this,arguments)};return h.prototype=f,h.prototype.constructor=h,h.extend=arguments.callee,h.getType=function(){return a},h},d},f={COMPONENT:1,ENV:2},g=function(){var a=100,b=function(){this.arrived={},this.buffer={}},c=b.prototype;c.count=function(){var a=0;for(var b in this.buffer)++a;return a},c.add=function(b,c){var d=this;if(d.count()>=a&&!(b in d.buffer)){var e=new Data,f="";for(var g in d.arrived)d.arrived[g]<e&&(e=d.arrived[g],f=g);delete d.buffer[f],delete d.arrived[f]}d.buffer[b]=c,d.arrived[b]=new Date},c.get=function(a){var b=this;if(a in b.buffer){var c=b.buffer[a];return delete b.buffer[a],delete b.arrived[a],c}return null};var d={},e=0,f=new b;return{publish:function(a,b,c){if(!d[a])return void f.add(a,{d:b,f:c});var e=d[a];for(var g in e)e[g].cb(a,b,c)},subscribe:function(a,b){d[a]||(d[a]=[]);var c=++e;d[a].push({token:c,cb:b});var g=f.get(a);return g&&b(a,g.d,g.f),c},unsubscribe:function(a,b){if(a in d){var c=d[a];for(var e in c)if(c[e].token===b){c.splice(e,1);break}0===c.length&&delete d[a]}}}}(),h=function(){var a={},b=d(),c={js:function(a,b){var c=document.createElement("script");c.src=a;var d=!1;c.onload=c.onreadystatechange=function(){var a=this.readyState;d||a&&"loaded"!=a&&"complete"!=a||(d=!0,b(!1,!0),c.onload=c.onreadystatechange=null)},document.getElementsByTagName("head")[0].appendChild(c)},css:function(a,b){var c=document.createElement("link");c.rel="stylesheet",c.href=a,document.getElementsByTagName("head")[0].appendChild(c),b(!1,!0)},ajax:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===c.readyState){var a=c.status,d=c.responseText;200!==a&&0!==a||!d?b("unexpected server resposne: "+a):b(!1,d)}},c.send("")}},e=function(a){return c[a.split(".").pop()]||c.ajax},f=function(b,c){e(b)(b,function(d,e){d&&console.error("Require error: "+d),a[b]=e,c(e)})};return function(c,d){c in a?d(a[c]):b(c,function(a){f(c,function(b){a(function(a){a(b)})})},d)}}(),i=a.location,j="file:"===i.protocol?"http:":i.protocol,k="f-component",l=function(a){a()},m=0,n=e(f.ENV).extend({prefixComponent:"/",prefixTemplate:"/",requireList:[],domParser:j+"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js",templateEngine:j+"//cdnjs.cloudflare.com/ajax/libs/hogan.js/3.0.0/hogan.js",compile:function(a){return Hogan.compile(a)},render:function(a,b,c){return a.render(b,c)},init:function(){var a=this;a.sourceRoot=a.sourceRoot||function(a){return a.split("/").slice(0,-1).join("/")+"/"}(i.pathname)},resolveUrl:function(a){return 0===a.indexOf("http")||0===a.indexOf("//")?a:this.sourceRoot+(0===a.indexOf("/")?a.slice(1):a)},setup:function(a){var b=this;b.requireList.unshift(b.domParser),b.requireList.unshift(b.templateEngine),b.require(b.requireList,function(){$.event.special.destroyed={remove:function(a){a.handler&&a.handler()}},a()})},require:function(a,b){var d=this;if(Array.isArray(a)){var e=a.map(function(a){return d.resolveUrl(a)});c(e,h,b)}else{var f=d.resolveUrl(a);h(f,b)}},getTemplate:function(){var a="tmpl";return function(b,c){var d=this,e=b.split(".").pop();if(e!==a){var f=$('template[name="template_'+b+'"]');if(f.length>0)return c(f.html())}var g=d.prefixTemplate+b+(e!=a?"."+a:"");d.require(g,c)}}(),requireComponent:function(a,b){var c=this,d=t(a);if(d)b(d);else{var e=c.prefixComponent+a+".js";c.require(e,function(){b(t(a))})}}}),o=e(f.COMPONENT).extend({init:function(a,b,c){var d=this;d.name=a,d.$container=b,d.env=c,d.id=++m,d.$=d.$container.find.bind(d.$container),d.rendered=!1,d.subscribeList={},d.buffered=[],d.templateName=d.templateName||d.name,d.resetDisplay&&d.$container.css("display",d.resetDisplay),d.$container.on("destroyed",d.unload.bind(d)),"string"==typeof d.template&&(d.template=d.env.compile(d.template))},load:function(a,b){var c=this;a=a||{},c.getData(function(d,e){c.getTemplate(function(f){c.render(d,e,f,function(){c.afterRender(function(){c.rendered=!0,c.myselfLoaded(function(){c.loadChildren(function(){c.allLoaded(function(){console.timeEnd("Component."+c.name+c.id),b&&b()},a)},a)},a)},a)},a)},a)},a)},getData:l,getTemplate:function(a){var b=this;b.template?a(b.template):b.env.getTemplate(b.templateName,function(c){b.template||(b.template=b.env.compile(c)),a(b.template)})},render:function(a,b,c,d){var e=this,f=e.env.render(c,a,b);e.$container.html(f),d()},afterRender:l,myselfLoaded:function(a){for(var b=this.buffered;b.length>0;)b.pop()();a()},loadChildren:function(a,d){var e=this,f=e.$("["+k+"]"),g=f.length;return g?void c(f,function(a,c){var f=$(a),g=f.attr(k);e.env.requireComponent(g,function(a){var h=new a(g,f,e.env);!function(a,c){b(function(){a.load(d,c)})}(h,c)})},function(){a&&a()}):void(a&&a())},allLoaded:l,unload:function(){this.unsubscribe()},publish:function(a,b){g.publish(a,b,this)},subscribe:function(a,b){var c=this;c.subscribeList[a]=g.subscribe(a,function(a,d,e){c.rendered?b(a,d,e):c.buffered.push(function(){b(a,d,e)})})},unsubscribe:function(a){var b=this.subscribeList;if(a)a in b&&g.unsubscribe(a,b[a]);else for(var c in b)g.unsubscribe(c,b[c])}}),p=!1,q=[],r={},s="env.changed",t=function(a){return r[a]||null},u={};u.getComponentByName=t,u.Pubsub=g;var v=a.F=function(a){p?a(u):q.push(a)};v.ComponentBase=o,v.component=function(a,b,c){r[a]=(c||o).extend(b||{})},v.env=function(a){var b=new n(a);b.setup(function(){g.publish(s,b)})},v.init=function(b,c){if(g.subscribe(s,function(b,d){g.unsubscribe(s),p=!0;for(var e=0,f=q.length;f>e;++e)q[e](u);q=[];var h=new o("",$(a.document),d);h.loadChildren(function(){console.timeEnd("build"),c&&c()})}),"string"==typeof b){var d=b;h(d)}else v.env(b)}}(window);
//# sourceMappingURL=fractal.min.js.map