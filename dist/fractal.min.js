!function(a){var b=!1,c=[],d={},e=a.Fractal=a.F=function(a,e){var f=null;if("function"==typeof a)f=a;else if("string"==typeof a&&e){var g=a,h=e;f=function(){d.define(g,h)}}if(f)return b?f():void c.push(f)};e.__=d,e.init=function(a){c&&c.length&&(c.forEach(function(a){a(d)}),c=[]),b=!0,e.Component=d.Component,e.Env=d.Env,a()},e.construct=function(b,c){"function"==typeof b&&(c=b,b=null),b||(b=new d.Env),b.setup(function(){var d=new e.Component("",$(a.document),b);d.loadChildren(function(){console.timeEnd("F.construct"),c&&c()})})}}(window),F(function(a){a.forEachAsync=function(a,b,c){var d=a.length;if(!d)return c();for(var e=0,f=0;d>e;++e)b(a[e],function(){++f===d&&c()})},a.createAsyncCall=function(){var a={},b=function(b,c){var d=a[b];delete a[b],d.forEach(function(a){a(c)})};return function(c,d,e,f){if(c in a)return void a[c].push(f);var g=setTimeout(function(){console.error("asyncCall timeout: "+c),b(c)},2e4);a[c]=[f],d(c,e,function(a){clearTimeout(g),b(c,a)})}},a.defineClass=function(a){var b=!1,c=/xyz/.test(function(){})?/\b_super\b/:/.*/,d=function(){};return d.extend=function(d){var e=this.prototype;b=!0;var f=new this;b=!1;for(var g in d)f[g]="function"==typeof d[g]&&"function"==typeof e[g]&&c.test(d[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,d[g]):d[g];var h=function(){!b&&this.init&&this.init.apply(this,arguments)};return h.prototype=f,h.prototype.constructor=h,h.extend=arguments.callee,h.getType=function(){return a},h},d},a.isClass=function(a,b){return a.getType?b?a.getType()===b:!0:!1},a.ClassType={COMPONENT:1,ENV:2}}),F(function(a){var b=a.ClassType,c=a.createAsyncCall,d=function(){var a={js:1,css:1,tmpl:1};return function(b){var c=b.split(".").pop();return c in a?c:"tmpl"}}();!function(){var d=null,f=null,g=0,h=[],i=function(a){if(a!==f)return!1;--g;var b=d;return d={},0===g&&(f=null,g=0),b},j=function(a){return f&&f!==a?!1:(f=a,++g,d={},!0)},k=function(){var a=c(),b=function(a,c,d){j(c)?e(a,function(){var a=i(c);h.length&&h.shift()(),d(a)}):h.push(function(){b(a,c,d)})};return function(c,d,e){a(d,b,c,e)}}();a.define=function(a,b){d[a]=b},a.requireComponent=function(a,c,d){k(b.COMPONENT+"."+a,c,d)},a.requireEnv=function(a,c){k(b.ENV,a,c)}}();var e=a.require=function(){var b=function(a,b){var c=!1;a.onload=a.onreadystatechange=function(){var d=this.readyState;c||d&&"loaded"!=d&&"complete"!=d||(c=!0,b(!1,!0),a.onload=a.onreadystatechange=null)};var d=document.getElementsByTagName("head")[0];d.appendChild(a)},e=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===c.readyState){var a=c.status,d=c.responseText;200!==a&&0!==a||!d?b("unexpected server resposne: "+a):b(!1,d)}},c.send("")},f={js:function(a,c){var d=document.createElement("script");d.src=a,b(d,c)},css:function(a,b){var c=document.createElement("link");c.rel="stylesheet",c.href=a,document.getElementsByTagName("head")[0].appendChild(c),b(!1,!0)},tmpl:e},g=function(){var a={},b=c(),e=function(b,c,e){var g=d(b);f[g](b,function(c,d){c&&console.error("Require error: "+c),a[b]=d,e(d)})};return function(c,d){return c in a?d(a[c]):void b(c,e,null,d)}}();return function(b,c){if(!Array.isArray(b))return g(b,c);if(!b.length)return c();var d={};a.forEachAsync(b,function(a,b){g(a,function(a,c){d[c]=a,b()})},function(){c(d)})}}()}),F(function(a){var b=100,c=function(){this.arrived={},this.buffer={}},d=c.prototype;d.count=function(){var a=0;for(var b in this.buffer)++a;return a},d.add=function(a,c){var d=this;if(d.count()>=b&&!(a in d.buffer)){var e=new Data,f="";for(var g in d.arrived)d.arrived[g]<e&&(e=d.arrived[g],f=g);delete d.buffer[f],delete d.arrived[f]}d.buffer[a]=c,d.arrived[a]=new Date},d.get=function(a){var b=this;if(a in b.buffer){var c=b.buffer[a];return delete b.buffer[a],delete b.arrived[a],c}return null};var e={},f=0,g=new c;a.Pubsub=function(){return{publish:function(a,b,c){if(!e[a])return void g.add(a,{d:b,f:c});var d=e[a];for(var f in d)d[f].cb(a,b,c)},subscribe:function(a,b){e[a]||(e[a]=[]);var c=++f;e[a].push({token:c,cb:b});var d=g.get(a);return d&&b(a,d.d,d.f),c},unsubscribe:function(a,b){if(a in e){var c=e[a];for(var d in c)if(c[d].token===b){c.splice(d,1);break}0===c.length&&delete e[a]}}}}()}),F(function(a){var b=(a.isClass,a.ClassType.ENV),c=a.createAsyncCall,d=a.require,e={},f=function(a){return"file:"===a?"http:":a}(window.location.protocol),g=a.Env=a.defineClass(b).extend({PrefixComponent:"/",PrefixTemplate:"/",Envs:{},Requires:[],DomParser:f+"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js",TemplateEngine:f+"//cdnjs.cloudflare.com/ajax/libs/hogan.js/3.0.0/hogan.js",compile:function(a){return Hogan.compile(a)},render:function(a,b,c){return a.render(b,c)},init:function(a,b){var d=this;d.__name=a,d.SourceRoot=d.SourceRoot||function(a){return a.split("/").slice(0,-1).join("/")+"/"}(b||window.location.pathname);for(var f in d.Envs)e[f]=d.resolveUrl(d.Envs[f]);d.asyncCall=c(),d.components={}},resolveUrl:function(a){return 0===a.indexOf("http")||0===a.indexOf("//")?a:this.SourceRoot+(0===a.indexOf("/")?a.slice(1):a)},getName:function(){return this.__name},setup:function(a){var b=this;b.require([b.DomParser,b.TemplateEngine],function(){$.event.special.destroyed={remove:function(a){a.handler&&a.handler()}},b.require(b.Requires,function(){a()})})},require:function(a,b){var c=this;Array.isArray(a)?d(a.map(function(a){return c.resolveUrl(a)}),b):d(c.resolveUrl(a),b)},getTemplate:function(){var a=function(a,b,c){var d=this;d.require(a,function(a){c(d.compile(a))})};return function(b,c){var d=this;d.asyncCall(d.PrefixTemplate+b+".tmpl",a.bind(d),null,c)}}(),getComponentClass:function(){var b=function(b,c,d){var e=this,f=e.resolveUrl(e.PrefixComponent+b+".js");a.requireComponent(e.__name,f,function(a){for(var c in a)e.components[c]=a[c];d(a[b])})};return function(a,c){var d,e=this;if(a.indexOf(":")>=0){var f=a.split(":");if(d=f[1],f[0]!==e.__name)return void h(f[0],function(a){a.getComponentClass(d,c)})}else d=a;var g=e.components;return d in g?c(g[d],d,e):void e.asyncCall(d,b.bind(e),null,function(a){c(a,d,e)})}}()}),h=function(){var b={},d=c(),f=function(a,c,d,e){var f=new a(c,d);f.setup(function(){b[c]=f,e(f)})},h=function(b,c,d){if(!(b in e))throw new Error("unknown env name: "+b);var h=e[b],i=h.split(".").pop();"js"!==i?("/"!==h[h.length-1]&&(h+="/"),f(g,b,h,d)):a.requireEnv(h,function(a){var c=a[b];f(c,b,h,d)})};return function(a,c){return a in b?c(b[a]):void d(a,h,null,c)}}()}),F(function(a){var b=a.isClass,c=a.Pubsub,d=a.ClassType.COMPONENT,e="[data-role=component]",f=function(a){a()},g=function(a,c,e){b(a,d)?e(a):a(c,e)};a.Component=a.defineClass(d).extend({init:function(a,b,c){var d=this;d.name=a,d.$container=b,d.F=c,d.fullName=d.F.getName()+":"+a,d.$=d.$container.find.bind(d.$container);var e=d.$container.data("display");e&&d.$container.css("display",e),d.$container.on("destroyed",d.unload.bind(d)),d.rendered=!1,d.subscribeList={},d.earlyRecieved=[],d.templateName=d.templateName||d.name,"string"==typeof d.template&&(d.template=d.F.compile(d.template));var f=d.Public||{};for(var g in f)!function(a,b){d.subscribe(a,function(a,c,e){b.bind(d)(c,e)})}(d.fullName+"."+g,f[g])},call:function(a,b){var c=this;a.indexOf(":")<0&&(a=c.F.getName()+":"+a),c.publish(a,b,c)},load:function(a,b){var c=this;a=a||{},c.getData(function(d,e){c.getTemplate(function(){c.render(d,e,function(){c.afterRender(function(){c.rendered=!0,c.myselfLoaded(function(){c.loadChildren(function(){c.allLoaded(function(){console.timeEnd(c.fullName),b&&b()},a)},a)},a)},a)},a)},a)},a)},getData:f,getTemplate:function(a){var b=this;if(b.template)return a();var c=b.$('script[type="text/template"]');return c.length>0?(b.template=b.F.compile(c.html()),a()):void b.F.getTemplate(b.templateName||b.name,function(c){b.template=c,a()})},render:function(a,b,c){var d=this,e=d.F.render(d.template,a,b);d.$container.html(e),c()},afterRender:f,myselfLoaded:function(a){for(var b=this.earlyRecieved;b.length>0;)b.pop()();a()},loadChildren:function(c,f){var h=this,i=h.$(e),j=i.length;return j?void a.forEachAsync(i,function(a,c){var e=$(a),i=e.data("name");h.F.getComponentClass(i,function(a,h,i){g(a,i,function(a){if(!b(a,d))throw new Error("unexpected component class: "+i.getName()+":"+h);var g=new a(h,e,i);g.load(f,c)})})},function(){c&&c()}):void(c&&c())},allLoaded:f,unload:function(){this.unsubscribe()},require:function(a,b,c){this.F.require(a,b,c)},publish:function(a,b){c.publish(a,b,this)},subscribe:function(a,b){var d=this;d.subscribeList[a]=c.subscribe(a,function(a,c,e){d.rendered?b(a,c,e):d.earlyRecieved.push(function(){b(a,c,e)})})},unsubscribe:function(a){var b=this.subscribeList;if(a)a in b&&c.unsubscribe(a,b[a]);else for(var d in b)c.unsubscribe(d,b[d])}})});
//# sourceMappingURL=fractal.min.js.map