!function(a){var b=!1,c=[],d=a.F=function(a,d){var e=null;if("function"==typeof a)e=a;else{if("string"!=typeof a||!d)return;var f=a,g=d;e=function(){j.define(f,g)}}b?e():c.push(e)};d.construct=function(e,f){"function"==typeof e&&(f=e,e=null),e||(e=new d.Env("")),e.setup(function(){b=!0;for(var g=0,h=c.length;h>g;++g)c[g]();c=[];var i=new d.Component("",$(a.document),e);i.loadChildren(function(){console.timeEnd("F.construct"),f&&f()})})};var e=function(a,b,c){var d,e;if(d=e=a.length)for(;d;)b(a[--d],function(){--e||c()});else c()},f=function(){var a={};return function(b,c,d){b in a?a[b].push(d):(a[b]=[d],c(function(c){var d=a[b],e=d.length;for(delete a[b];e;)c(d[--e])}))}},g=function(a){var b=!1,c=/xyz/.test(function(){})?/\b_super\b/:/.*/,d=function(){};return d.extend=function(d){var e=this.prototype;b=!0;var f=new this;b=!1;for(var g in d)f[g]="function"==typeof d[g]&&"function"==typeof e[g]&&c.test(d[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,d[g]):d[g];var h=function(){!b&&this.init&&this.init.apply(this,arguments)};return h.prototype=f,h.prototype.constructor=h,h.extend=arguments.callee,h.getType=function(){return a},h},d},h=function(a,b){return a.getType?b?a.getType()===b:!0:!1},i={COMPONENT:1,ENV:2},j=function(){var a=null,b=null,c=0,d=[],e=function(d){if(d!==b)return!1;--c;var e=a;return a={},0===c&&(b=null,c=0),e},g=function(d){return b&&b!==d?!1:(b=d,++c,a={},!0)},h=f(),j=function(a,b,c){g(a)?k(b,function(){var b=e(a);d.length&&d.shift()(),c(b)}):d.push(function(){j(a,b,c)})},l=function(a,b,c){h(b,function(c){j(a,b,function(a){c(function(b){b(a)})})},c)};return{define:function(b,c){a[b]=c},requireComponent:function(a,b,c){l(i.COMPONENT+"."+a,b,c)},requireEnv:function(a,b){l(i.ENV,a,b)}}}(),k=function(){var a={js:1,css:1,tmpl:1},b=function(b){var c=b.split(".").pop();return c in a?c:"tmpl"},c=function(a,b){var c=!1;a.onload=a.onreadystatechange=function(){var d=this.readyState;c||d&&"loaded"!=d&&"complete"!=d||(c=!0,b(!1,!0),a.onload=a.onreadystatechange=null)};var d=document.getElementsByTagName("head")[0];d.appendChild(a)},d=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===c.readyState){var a=c.status,d=c.responseText;200!==a&&0!==a||!d?b("unexpected server resposne: "+a):b(!1,d)}},c.send("")},e={js:function(a,b){var d=document.createElement("script");d.src=a,c(d,b)},css:function(a,b){var c=document.createElement("link");c.rel="stylesheet",c.href=a,document.getElementsByTagName("head")[0].appendChild(c),b(!1,!0)},tmpl:d};return function(){var a={},c=f(),d=function(c,d){var f=b(c);e[f](c,function(b,e){b&&console.error("Require error: "+b),a[c]=e,d(e)})};return function(b,e){return b in a?e(a[b]):void c(b,function(a){d(b,function(b){a(function(a){a(b)})})},e)}}()}();d.Pubsub=function(){var a=100,b=function(){this.arrived={},this.buffer={}},c=b.prototype;c.count=function(){var a=0;for(var b in this.buffer)++a;return a},c.add=function(b,c){var d=this;if(d.count()>=a&&!(b in d.buffer)){var e=new Data,f="";for(var g in d.arrived)d.arrived[g]<e&&(e=d.arrived[g],f=g);delete d.buffer[f],delete d.arrived[f]}d.buffer[b]=c,d.arrived[b]=new Date},c.get=function(a){var b=this;if(a in b.buffer){var c=b.buffer[a];return delete b.buffer[a],delete b.arrived[a],c}return null};var d={},e=0,f=new b;return{publish:function(a,b,c){if(!d[a])return void f.add(a,{d:b,f:c});var e=d[a];for(var g in e)e[g].cb(a,b,c)},subscribe:function(a,b){d[a]||(d[a]=[]);var c=++e;d[a].push({token:c,cb:b});var g=f.get(a);return g&&b(a,g.d,g.f),c},unsubscribe:function(a,b){if(a in d){var c=d[a];for(var e in c)if(c[e].token===b){c.splice(e,1);break}0===c.length&&delete d[a]}}}}(),d.Env=function(){var a={},b=function(a){return"file:"===a?"http:":a}(window.location.protocol),c=function(){var b={},c=f(),e=function(a,c,d,e){var f=new a(c,d);f.setup(function(){b[c]=f,e(f)})},g=function(b,c){if(!(b in a))throw new Error("unknown env name: "+b);var f=a[b],g=f.split(".").pop();"js"!==g?("/"!==f[f.length-1]&&(f+="/"),e(d.Env,b,f,c)):j.requireEnv(f,function(a){var d=a[b];e(d,b,f,c)})};return function(a,d){return a in b?d(b[a]):void c(a,function(b){g(a,function(a){b(function(b){b(a)})})},d)}}();return g(i.ENV).extend({PrefixComponent:"/",PrefixTemplate:"/",Envs:{},Requires:[],DomParser:b+"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js",TemplateEngine:b+"//cdnjs.cloudflare.com/ajax/libs/hogan.js/3.0.0/hogan.js",compile:function(a){return Hogan.compile(a)},render:function(a,b,c){return a.render(b,c)},init:function(b,c){var d=this;d.ready=!1,d.name=b,d.SourceRoot=d.SourceRoot||function(a){return a.split("/").slice(0,-1).join("/")+"/"}(c||window.location.pathname);for(var e in d.Envs)a[e]=d.resolveUrl(d.Envs[e]);d.asyncOnce=f(),d.components={},d.templates={}},resolveUrl:function(a){return 0===a.indexOf("http")||0===a.indexOf("//")?a:this.SourceRoot+(0===a.indexOf("/")?a.slice(1):a)},setup:function(a){var b=this;return b.ready?a():void b.require([b.DomParser,b.TemplateEngine],function(){$.event.special.destroyed={remove:function(a){a.handler&&a.handler()}},b.require(b.Requires,function(){b.ready=!0,a()})})},require:function(a,b){var c=this;if(Array.isArray(a)){var d={};e(a,function(a,b){k(c.resolveUrl(a),function(c){d[a]=c,b()})},function(){b(d)})}else k(c.resolveUrl(a),b)},getTemplate:function(){var a="tmpl",b=function(a,b,c){a.require(b,function(b){c(a.compile(b))})};return function(c,d){var e=this;if(c in e.templates)return d(e.templates[c]);var f=c.split(".").pop();if(f!==a){var g=$("template#template_"+c);if(g.length>0){var h=e.templates[c]=e.compile(g.html());return d(h)}}var i=e.PrefixTemplate+c;f!==a&&(i+="."+a),e.asyncOnce(i,function(a){b(e,i,function(b){e.templates[c]=b,a(function(a){a(b)})})},d)}}(),requireComponent:function(){var a=function(b,d,e,f){if(d!==b.name)c(d,function(b){a(b,d,e,f)});else{var g=b.components;if(e in g)return f(g[e],e,b);var h=b.resolveUrl(b.PrefixComponent+e+".js");j.requireComponent(d,h,function(a){for(var c in a)g[c]=a[c];f(g[e],e,b)})}};return function(b,c){var d,e,f=this;if(b.indexOf(":")>=0){var g=b.split(":");d=g[0],e=g[1]}else d=f.name,e=b,b=d+":"+e;f.asyncOnce(b,function(b){a(f,d,e,function(a,c,d){h(a,i.COMPONENT)?b(function(b){b(a,c,d)}):a(d,function(a){b(function(b){b(a,c,d)})})})},c)}}()})}(),d.Component=function(){var a=d.Pubsub,b=i.COMPONENT,c="f-component",f=function(a){a()};return g(b).extend({init:function(a,b,c){var d=this;d.name=a,d.$container=b,d.F=c,d.fullName=d.F.name+":"+a,d.$=d.$container.find.bind(d.$container);var e=d.$container.attr("f-display");e&&d.$container.css("display",e),d.$container.on("destroyed",d.unload.bind(d)),d.rendered=!1,d.subscribeList={},d.earlyRecieved=[],d.templateName=d.templateName||d.name,"string"==typeof d.template&&(d.template=d.F.compile(d.template));var f=d.Public||{};for(var g in f)!function(a,b){d.subscribe(a,function(a,c,e){b.bind(d)(c,e)})}(d.fullName+"."+g,f[g])},call:function(a,b){var c=this;a.indexOf(":")<0&&(a=c.F.name+":"+a),c.publish(a,b,c)},load:function(a,b){var c=this;a=a||{},c.getData(function(d,e){c.getTemplate(function(){c.render(d,e,function(){c.afterRender(function(){c.rendered=!0,c.myselfLoaded(function(){c.loadChildren(function(){c.allLoaded(function(){console.timeEnd(c.fullName),b&&b()},a)},a)},a)},a)},a)},a)},a)},getData:f,getTemplate:function(a){var b=this;if(b.template)return a();var c=b.templateName||b.name;b.F.getTemplate(c,function(c){b.template=c,a()})},render:function(a,b,c){var d=this,e=d.F.render(d.template,a,b);d.$container.html(e),c()},afterRender:f,myselfLoaded:function(a){for(var b=this.earlyRecieved;b.length>0;)b.pop()();a()},loadChildren:function(a,d){var f=this,g=f.$("["+c+"]"),i=g.length;return i?void e(g,function(a,e){var g=$(a),i=g.attr(c);f.F.requireComponent(i,function(a,c,f){if(!h(a,b))throw new Error("not component class: "+f.name+":"+c);var i=new a(c,g,f);i.load(d,e)})},function(){a&&a()}):void(a&&a())},allLoaded:f,unload:function(){this.unsubscribe()},publish:function(b,c){a.publish(b,c,this)},subscribe:function(b,c){var d=this;d.subscribeList[b]=a.subscribe(b,function(a,b,e){d.rendered?c(a,b,e):d.earlyRecieved.push(function(){c(a,b,e)})})},unsubscribe:function(b){var c=this.subscribeList;if(b)b in c&&a.unsubscribe(b,c[b]);else for(var d in c)a.unsubscribe(d,c[d])}})}()}(window);
//# sourceMappingURL=fractal.min.js.map