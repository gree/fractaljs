!function(a){var b=!1,c=[],d={},e=a.Fractal=a.F=function(a,e){var f=null;if("function"==typeof a)f=a;else if("string"==typeof a&&"function"==typeof e){var g=a,h=e;f=function(){d.ObjectLoader.component.define(g,h)}}else if("object"==typeof a){var i=a;f=function(){d.ObjectLoader.config.define(i)}}if(f)return b?f():void c.push(f)};e.__=d,e.construct=function(f,g){"function"==typeof f&&(g=f,f={}),d.createDefaultEnv(f,function(d){c&&c.length&&(c.forEach(function(a){a()}),c=[]),e.Component=e.__.Component,b=!0;var f=new e.Component("__ROOT__",$(a.document),d);f.loadChildren(g)})},e.TOPIC={COMPONENT_LOADED_MYSELF:"component.loaded.myself",COMPONENT_LOADED_CHILDREN:"component.loaded.children"},d.forEachAsync=function(a,b,c){var d=a.length;if(!d)return c();for(var e=0,f=0;d>e;++e)b(a[e],function(){++f===d&&c()})}}(window),function(a){a.ObjectLoader=function(){var b=null,c=[],d={get:function(){return b?!1:(b={},!0)},release:function(){b=null}},e=function(a){return d.get()?(a(function(){d.release(),c.length&&e(c.shift())}),!0):(c.push(a),!1)};return{component:{define:function(a,c){b.components[a]=c},load:function(c,d){e(function(e){b.components={},a.require(c,function(){var a=b.components;e(),d(a)})})}},config:{define:function(a){b.config=a},load:function(c,d){e(function(e){a.require(c,function(){var a=b.config;e(),d(a)})})}}}}(),a.require=function(){var b=function(a,b){var c=!1;a.onload=a.onreadystatechange=function(){c||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(c=!0,b(!1,!0),a.onload=a.onreadystatechange=null)};var d=document.getElementsByTagName("head")[0];d.appendChild(a)},c=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===c.readyState){200!==c.status&&0!==c.status||!c.responseText?b("unexpected server resposne: "+c.status):b(!1,c.responseText)}},c.send("")},d={js:function(a,c){var d=document.createElement("script");d.src=a,b(d,c)},css:function(a,b){var c=document.createElement("link");c.rel="stylesheet",c.href=a,document.getElementsByTagName("head")[0].appendChild(c),b(!1,!0)},tmpl:c},e=function(){var a={},b={},c=function(b,c){a[b.url].forEach(function(a){a(c,b.id)}),delete a[b.url]};return function(e,f){if(e.url in b)return void f(b[e.url],e.id);if(e.url in a)return void a[e.url].push(f);var g=setTimeout(function(){console.error("Require timeout: "+e.url),c(e)},1e4);a[e.url]=[f],d[e.type](e.url,function(a,d){clearTimeout(g),a?console.error("Require error: "+a):b[e.url]=d,c(e,d)})}}();return function(b,c){if(!Array.isArray(b))return e(b,c);var d={};a.forEachAsync(b,function(a,b){e(a,function(a,c){d[c]=a,b()})},function(){c(d)})}}()}(window.F.__),function(a){var b=100,c=function(){this.arrived={},this.buffer={}},d=c.prototype;d.count=function(){var a=0;for(var b in this.buffer)++a;return a},d.add=function(a,c){if(this.count()>=b&&!(a in this.buffer)){var d=new Data,e="";for(var f in this.arrived)this.arrived[f]<d&&(d=this.arrived[f],e=f);delete this.buffer[e],delete this.arrived[e]}this.buffer[a]=c,this.arrived[a]=new Date},d.get=function(a){if(a in this.buffer){var b=this.buffer[a];return delete this.buffer[a],delete this.arrived[a],b}return null};var e={},f=0,g=new c;a.Pubsub=function(){return{publish:function(a,b,c){if(!e[a])return void g.add(a,{d:b,f:c});var d=e[a];for(var f in d)d[f].cb(a,b,c)},subscribe:function(a,b){e[a]||(e[a]=[]);var c=++f;e[a].push({token:c,cb:b});var d=g.get(a);return d&&b(a,d.d,d.f),c},unsubscribe:function(a,b){if(a in e){var c=e[a];for(var d in c)if(c[d].token===b){c.splice(d,1);break}0===c.length&&delete e[a]}}}}()}(window.F.__),function(a,b){var c={},d=function(){var a={js:1,css:1,tmpl:1};return function(b){var c=b.split(".").pop();return c in a?c:"tmpl"}}(),e=function(){var e=function(a,b){var c=d(b),e=function(){return 0===b.indexOf("http")||0===b.indexOf("//")?b:a.SourceRoot+(0===b.indexOf("/")?b.slice(1):b)}(c);return{id:b,type:c,url:e}},g="file:"==b.location.protocol?"http:":b.location.protocol,h={DomParser:g+"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js",Template:{Engine:g+"//cdnjs.cloudflare.com/ajax/libs/hogan.js/3.0.0/hogan.js",Compile:function(a){return Hogan.compile(a)},Render:function(a,b,c){return a.render(b,c)}},Prefix:{Component:"components/",Template:"templates/"},Envs:{},Requires:[]},i=function(a,c,d){this.__name=a,this.descUrl=c,d=d||{},this.SourceRoot=d.SourceRoot||function(a){return a.split("/").slice(0,-1).join("/")+"/"}(c||b.location.pathname),this.components={};for(var e in h)this[e]=d[e]||h[e];var f=this;["Template","Prefix"].forEach(function(a){for(var b in h[a])f[a][b]=f[a][b]||h[a][b]})},j=i.prototype;return j.getDisplayName=function(){return this.__name||"[defaultEnv]"},j.getName=function(){return this.__name},j.init=function(a){var b=this;for(var d in b.Envs)c[d]=b.Envs[d];b.require([b.DomParser,b.Template.Engine],function(){$.event.special.destroyed={remove:function(a){a.handler&&a.handler()}},b.require(b.Requires,function(){a(b)})})},j.require=function(b,c){var d=this;Array.isArray(b)?a.require(b.map(function(a){return e(d,a)}),c):a.require(e(d,b),c)},j.getTemplate=function(){var b=function(a,b,c){var d=a.__name?a.__name+":"+b:b,e=$('script[type="text/template"][data-name="'+d+'"]');e.length>0?c(a.Template.Compile(e.html())):a.require(a.Prefix.Template+b+".tmpl",function(b){c(a.Template.Compile(b))})};return function(c,d){var e=this;if("string"==typeof c)return b(e,c,d);var f={};a.forEachAsync(c,function(a,c){b(e,a,function(b){f[a]=b,c()})},function(){d(f)})}}(),j.getComponentClass=function(b,c){var d=this;if(b.indexOf(":")>=0){var g=b.split(":"),h=g[0],i=g[1];f(h,function(a){a.getComponentClass(i,c)})}else if(b in d.components)c(d.components[b],b,d);else{var j=e(d,d.Prefix.Component+b+".js");a.ObjectLoader.component.load(j,function(e){var f=[];for(var g in e){var h=e[g];h.isComponent?d.components[g]=h:f.push({name:g,createClass:h})}a.forEachAsync(f,function(a,b){a.createClass(d,function(c){d.components[a.name]=c,b()})},function(){if(!(b in e))throw new Error("component "+b+" is not found in "+j.url);c(d.components[b],b,d)})})}},i}(),f=function(){var b={};return function(d,f){if(!d)return f(a.defaultEnv);if(d in b)return f(b[d]);if(!(d in c))throw new Error("unknown env name: "+d);var g=function(a){b[d]=a,f(a)},h=c[d],i=h.split(".").pop();if("js"!==i){"/"!==h[h.length-1]&&(h+="/");var j=new e(d,h);j.init(g)}else a.ObjectLoader.config.load({type:"js",url:h},function(a){var b=new e(d,h,a);b.init(g)})}}();a.createDefaultEnv=function(b,c){if(a.defaultEnv)return c(a.defaultEnv);var d=new e("","",b);d.init(function(){a.defaultEnv=d,c(d)})}}(window.F.__,window),function(a){var b=function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/,c=function(){};return c.extend=function(c){var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]="function"==typeof c[f]&&"function"==typeof d[f]&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];var g=function(){!a&&this.init&&this.init.apply(this,arguments)};return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g.isComponent=!0,g},c}();a.Component=function(){var c="[data-role=component]",d=function(a,b){if(b){if(!a.__load)return void(a.__load=b);var c=a.__load;a.__load=function(d,e){c.bind(a)(function(){b.bind(a)(d,e)},e)}}},e={};return e.init=function(a,b,c){this.name=a,this.$container=b,this.F=c,this.$=this.$container.find.bind(this.$container);var e=this.$container.data("display");e&&this.$container.css("display",e),this.$container.on("destroyed",this.unload.bind(this)),this.rendered=!1,this.subscribeList={},this.earlyRecieved=[],this.templateName=this.templateName||this.name,"string"==typeof this.template&&(this.template=this.F.Template.Compile(this.template)),d(this,this.getData),d(this,this.getTemplate),d(this,this.render),d(this,this.afterRender),d(this,this.myselfLoaded),this.loadMyselfOnly||d(this,this.loadChildren),d(this,this.allLoaded);var f=[];for(var g in this)"function"==typeof this[g]&&0===g.indexOf("on")&&f.push([g.substr(2),this[g]]);var h=this.Public||{};for(var g in h)f.push([this.F.getName()+":"+this.name+"."+g,h[g]]);var i=this;f.forEach(function(a){!function(a,b){i.subscribe(a,function(a,c,d){b.bind(i)(c,d)})}(a[0],a[1])})},e.call=function(a,b){var c=a;a.indexOf(":")<0&&(c=this.F.getName()+":"+c),this.publish(c,b,this)},e.__load=null,e.load=function(a,b){a=a||{},this.__load(function(){b&&b()},a)},e.getData=null,e.getTemplate=function(a){var b=this;return b.template?a():void b.F.getTemplate(b.templateName||b.name,function(c){b.template=c,a()})},e.render=function(a,b){var c=this.F.Template.Render(this.template,b.data,b.partials);this.$container.html(c),a()},e.afterRender=null,e.myselfLoaded=function(b){for(this.rendered=!0;this.earlyRecieved.length>0;)this.earlyRecieved.pop()();this.publish(a.TOPIC.COMPONENT_LOADED_MYSELF),b()},e.loadChildren=function(b,d){var e=this,f=e.$(c),g=f.length;return g?void a.forEachAsync(f,function(a,b){var c=$(a),f=c.data("name");e.F.getComponentClass(f,function(a,e,f){var g=new a(e,c,f);g.load(d,b)})},function(){e.publish(a.TOPIC.COMPONENT_LOADED_CHILDREN),b&&b()}):(e.publish(a.TOPIC.COMPONENT_LOADED_CHILDREN),void(b&&b()))},e.allLoaded=null,e.unload=function(){this.unsubscribe()},e.require=function(a,b,c){this.F.require(a,b,c)},e.publish=function(b,c){a.Pubsub.publish(b,c,this)},e.subscribe=function(b,c){var d=this;d.subscribeList[b]=a.Pubsub.subscribe(b,function(a,b,e){d.rendered?c(a,b,e):d.earlyRecieved.push(function(){c(a,b,e)})})},e.unsubscribe=function(b){if(b)b in this.subscribeList&&namspace.Pubsub.unsubscribe(b,this.subscribeList[b]);else for(var c in this.subscribeList)a.Pubsub.unsubscribe(c,this.subscribeList[c])},b.extend(e)}()}(window.F.__);
//# sourceMappingURL=fractal.min.js.map