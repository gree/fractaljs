!function(a){var b=function(){function a(a){if(a.source==window&&a.data==c&&(a.stopPropagation(),b.length>0)){var d=b.shift();d()}}var b=[],c=(new Date).getTime();return window.addEventListener("message",a,!0),function(a){b.push(a),window.postMessage(c,"*")}}(),c=function(a,b,c){var d,e;if(d=e=a.length)for(;d;)b(a[--d],function(){--e||c()});else c()},d=function(){var a={};return function(b,c,d){b in a?a[b].push(d):(a[b]=[d],c(function(c){var d=a[b],e=d.length;for(delete a[b];e;)c(d[--e])}))}},e=function(){var a={},b=0;return{publish:function(b,c,d){var e=a[b];for(var f in e)e[f].cb(b,c,d)},subscribe:function(c,d){a[c]||(a[c]=[]);var e=++b;return a[c].push({token:e,cb:d}),e},unsubscribe:function(b,c){if(b in a){var d=a[b];for(var e in d)if(d[e].token===c){d.splice(e,1);break}0===d.length&&delete a[b]}}}}(),f=function(){var a={},b=d(),c={js:function(a,b){var c=document.createElement("script");c.src=a;var d=!1;c.onload=c.onreadystatechange=function(){var a=this.readyState;d||a&&"loaded"!=a&&"complete"!=a||(d=!0,b(!1,!0),c.onload=c.onreadystatechange=null)},document.getElementsByTagName("head")[0].appendChild(c)},css:function(a,b){var c=document.createElement("link");c.rel="stylesheet",c.href=a,document.getElementsByTagName("head")[0].appendChild(c),b(!1,!0)},ajax:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===c.readyState){var a=c.status,d=c.responseText;200!==a&&0!==a||!d?b("unexpected server resposne: "+a):b(!1,d)}},c.send("")}},e=function(a){return c[a.split(".").pop()]||c.ajax},f=function(b,c){e(b)(b,function(d,e){d&&console.error("Require error: "+d),a[b]=e,c(e)})};return function(c,d){c in a?d(a[c]):b(c,function(a){f(c,function(b){a(function(a){a(b)})})},d)}}(),g=a.location,h="file:"===g.protocol?"http:":g.protocol,i="f-component",j="tmpl",k=function(){var b=0,d={prefixComponent:"/",prefixTemplate:"/",requireList:[],domParser:h+"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js",templateEngine:h+"//cdnjs.cloudflare.com/ajax/libs/hogan.js/3.0.0/hogan.js",compile:function(a){return Hogan.compile(a)},render:function(a,b,c){return a.render(b,c)}},e=function(a){var c=this;c.id=b++;for(var e in d)c[e]=d[e];for(var e in a)c[e]=a[e];c.sourceRoot=c.sourceRoot||function(a){return a.split("/").slice(0,-1).join("/")+"/"}(g.pathname),c.components={}},k=e.prototype;return k.init=function(a){var b=this;b.requireList.unshift(b.domParser),b.requireList.unshift(b.templateEngine),b.require(b.requireList,function(){$.event.special.destroyed={remove:function(a){a.handler&&a.handler()}},a()})},k.build=function(b,c,d){var e=this;e.$root=b||$(a.document);var f=e.$root.attr(i);if(f){var g=new l(f,e.$root,e);g.load(c,function(){console.timeEnd("env.build"+e.id),d&&d()})}else{var g=new l("",e.$root,e);g.loadChildren(function(){console.timeEnd("env.build"+e.id),d&&d()})}},k.resolveUrl=function(a){return 0===a.indexOf("http")||0===a.indexOf("//")?a:this.sourceRoot+(0===a.indexOf("/")?a.slice(1):a)},k.require=function(a,b){var d=this;if(Array.isArray(a)){var e=a.map(function(a){return d.resolveUrl(a)});c(e,f,b)}else{var g=d.resolveUrl(a);f(g,b)}},k.getTemplate=function(a,b){var c=this,d=a.split(".").pop();if(d!==j){var e=c.$root.find('template[name="template_'+a+'"]');if(e.length>0)return b(e.html())}var f=c.prefixTemplate+a+(d!=j?"."+j:"");c.require(f,b)},k.requireComponent=function(a,b){var c=this,d=c.components[a];if(d)b(d);else{var e=c.prefixComponent+a+".js";o(c,e,function(){b(c.components[a])})}},e}(),l=function(){var a=function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,c=function(){};return c.extend=function(c){var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]="function"==typeof c[f]&&"function"==typeof d[f]&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];var g=function(){!a&&this.init&&this.init.apply(this,arguments)};return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g},c}(),d=0,f=function(a){a()};return a.extend({init:function(a,b,c){var e=this;e.name=a,e.$container=b,e.env=c,e.id=d++,e.$=e.$container.find.bind(e.$container),e.rendered=!1,e.subscribeList={},e.buffered=[],e.templateName=e.templateName||e.name,e.resetDisplay&&e.$container.css("display",e.resetDisplay),e.$container.on("destroyed",e.unload.bind(e)),"string"==typeof e.template&&(e.template=e.env.compile(e.template))},load:function(a,b){var c=this;a=a||{},c.getData(function(d,e){c.getTemplate(function(f){c.render(d,e,f,function(){c.afterRender(function(){c.rendered=!0,c.myselfLoaded(function(){c.loadChildren(function(){c.allLoaded(function(){console.timeEnd("Component."+c.name+c.id),b&&b()},a)},a)},a)},a)},a)},a)},a)},getData:f,getTemplate:function(a){var b=this;b.template?a(b.template):b.env.getTemplate(b.templateName,function(c){b.template||(b.template=b.env.compile(c)),a(b.template)})},render:function(a,b,c,d){var e=this,f=e.env.render(c,a,b);e.$container.html(f),d()},afterRender:f,myselfLoaded:function(a){for(var b=this.buffered;b.length>0;)b.pop()();a()},loadChildren:function(a,d){var e=this,f=e.$("["+i+"]"),g=f.length;return g?void c(f,function(a,c){var f=$(a),g=f.attr(i);e.env.requireComponent(g,function(a){var h=new a(g,f,e.env);!function(a,c){b(function(){a.load(d,c)})}(h,c)})},a):a()},allLoaded:f,unload:function(){this.unsubscribe()},publish:function(a,b){e.publish(a,b,this)},subscribe:function(a,b){var c=this;c.subscribeList[a]=e.subscribe(a,function(a,d,e){c.rendered?b(a,d,e):c.buffered.push(function(){b(a,d,e)})})},unsubscribe:function(a){var b=this.subscribeList;if(a)a in b&&e.unsubscribe(a,b[a]);else for(var c in b)e.unsubscribe(c,b[c])}})}(),m=null,n=function(a,b,c){if(!m)throw new Error("disallowed operation");m.components[a]=(c||l).extend(b||{})},o=function(){var a=[],d=function(){if(a.length){for(var b={},e=[];a.length;){var f=a[0],g=f[0],h=f[1],i=f[2];if(m){if(g.id!=m.id)break}else m=g;a.shift(),b[h]=!0,e.push(i)}!function(a){var e=[];for(var f in b)e.push(f);e.length?c(e,function(a,b){g.require(a,b)},function(){var b=0;for(len=a.length;b<len;++b)a[b]();m=null,d()}):m=null}(e)}};return function(c,e,f){a.push([c,e,f]),b(d)}}();!function(){var b=a.F={};b.Pubsub=e,b.Env=k,b.ComponentBase=l,b.component=n,b.createEnv=function(a,b){"function"==typeof a&&(b=a,a={});var c=new k(a);c.init(function(){b(c)})}}()}(window);
//# sourceMappingURL=fractal.min.js.map