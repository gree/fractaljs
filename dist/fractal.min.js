!function(a){var b=!1,c=[],d={},e=a.Fractal=a.F=function(a,e){var f=null;if("function"==typeof a)f=a;else if("string"==typeof a&&"function"==typeof e){var g=a,h=e;f=function(){d.define(g,h)}}else if("object"==typeof a){var i=a;f=function(){d.define("",i)}}if(f)return b?f():void c.push(f)};e.__=d,e.construct=function(f,g){"function"==typeof f&&(g=f,f={}),d.createDefaultEnv(f,function(d){e.Component=e.__.Component,c&&c.length&&(c.forEach(function(a){a()}),c=[]),b=!0;var f=new e.Component("__ROOT__",$(a.document),d);f.loadChildren(function(){console.timeEnd("F.construct"),g&&g()})})}}(window),function(a){a.forEachAsync=function(a,b,c){var d=a.length;if(!d)return c();for(var e=0,f=0;d>e;++e)b(a[e],function(){++f===d&&c()})},a.createAsyncCall=function(){var a={},b={},c=function(b,c){a[b].forEach(function(a){a(c)}),delete a[b]};return function(d,e,f,g){if(d in b)return void g(b[d]);if(d in a)return void a[d].push(g);var h=setTimeout(function(){console.error("asyncCall timeout: "+d),c(d)},2e4);a[d]=[g],e(d,f,function(a,e){clearTimeout(h);var f;if(e){for(var g in a)b[g]=a[g];f=a[d]}else b[d]=a,f=a;c(d,f)})}}}(window.F.__),function(a){var b=function(){var a={js:1,css:1,tmpl:1};return function(b){var c=b.split(".").pop();return c in a?c:"tmpl"}}();!function(){var b=null,c=null,d=0,e=[],f=function(a){return a!==c?!1:(--d,b={},0===d&&(c=null,d=0),!0)},g=function(a){return c&&c!==a?!1:(c=a,++d,b={},!0)},h=function(){var c=a.createAsyncCall(),d=function(c,h,i){g(h)?a.require(c,function(){var a=b;f(h),e.length&&e.shift()(),i(a)}):e.push(function(){d(c,h,i)})};return function(a,b,e){c(b,d,a,e)}}();a.define=function(a,c){b[a]=c},a.requireComponents=function(a,b,c){h("component."+a,b,c)},a.requireConfig=function(a,b){h("config",a,function(a){for(var c in a)return void b(a[c]);b()})}}(),a.require=function(){var c=function(a,b){var c=!1;a.onload=a.onreadystatechange=function(){c||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(c=!0,b(!1,!0),a.onload=a.onreadystatechange=null)};var d=document.getElementsByTagName("head")[0];d.appendChild(a)},d=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=function(){if(4===c.readyState){200!==c.status&&0!==c.status||!c.responseText?b("unexpected server resposne: "+c.status):b(!1,c.responseText)}},c.send("")},e={js:function(a,b){var d=document.createElement("script");d.src=a,c(d,b)},css:function(a,b){var c=document.createElement("link");c.rel="stylesheet",c.href=a,document.getElementsByTagName("head")[0].appendChild(c),b(!1,!0)},tmpl:d},f=function(){var c=a.createAsyncCall(),d=function(a,c,d){var f=b(a);e[f](a,function(a,b){a&&console.error("Require error: "+a),d(b)})};return function(a,b){c(a,d,null,b)}}();return function(b,c){if(!Array.isArray(b))return f(b,c);if(!b.length)return c();var d={};a.forEachAsync(b,function(a,b){f(a,function(a,c){d[c]=a,b()})},function(){c(d)})}}()}(window.F.__),function(a){var b=100,c=function(){this.arrived={},this.buffer={}},d=c.prototype;d.count=function(){var a=0;for(var b in this.buffer)++a;return a},d.add=function(a,c){if(this.count()>=b&&!(a in this.buffer)){var d=new Data,e="";for(var f in this.arrived)this.arrived[f]<d&&(d=this.arrived[f],e=f);delete this.buffer[e],delete this.arrived[e]}this.buffer[a]=c,this.arrived[a]=new Date},d.get=function(a){if(a in this.buffer){var b=this.buffer[a];return delete this.buffer[a],delete this.arrived[a],b}return null};var e={},f=0,g=new c;a.Pubsub=function(){return{publish:function(a,b,c){if(!e[a])return void g.add(a,{d:b,f:c});var d=e[a];for(var f in d)d[f].cb(a,b,c)},subscribe:function(a,b){e[a]||(e[a]=[]);var c=++f;e[a].push({token:c,cb:b});var d=g.get(a);return d&&b(a,d.d,d.f),c},unsubscribe:function(a,b){if(a in e){var c=e[a];for(var d in c)if(c[d].token===b){c.splice(d,1);break}0===c.length&&delete e[a]}}}}()}(window.F.__),function(a,b){var c={},d=function(){var d="file:"==b.location.protocol?"http:":b.location.protocol,f={DomParser:d+"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js",Template:{Engine:d+"//cdnjs.cloudflare.com/ajax/libs/hogan.js/3.0.0/hogan.js",Compile:function(a){return Hogan.compile(a)},Render:function(a,b,c){return a.render(b,c)}},Prefix:{Component:"/",Template:"/"},Envs:{},Requires:[]},g=function(c,d,e){this.__name=c,this.descUrl=d,e=e||{},this.SourceRoot=e.SourceRoot||function(a){return a.split("/").slice(0,-1).join("/")+"/"}(d||b.location.pathname),this.components={};for(var g in f)this[g]=e[g]||f[g];var h=this;["Template","Prefix"].forEach(function(a){for(var b in f[a])h[a][b]=h[a][b]||f[a][b]}),h.asyncCall=a.createAsyncCall()},h=g.prototype;return h.resolveUrl=function(a){return 0===a.indexOf("http")||0===a.indexOf("//")?a:this.SourceRoot+(0===a.indexOf("/")?a.slice(1):a)},h.getName=function(){return this.__name},h.init=function(a){var b=this;for(var d in b.Envs)c[d]=b.resolveUrl(b.Envs[d]);b.require([b.DomParser,b.Template.Engine],function(){$.event.special.destroyed={remove:function(a){a.handler&&a.handler()}},b.require(b.Requires,function(){a()})})},h.require=function(b,c){var d=this;Array.isArray(b)?a.require(b.map(function(a){return d.resolveUrl(a)}),c):a.require(d.resolveUrl(b),c)},h.getTemplate=function(){var b=function(a,b,c){var d=a.__name?a.__name+":"+b:b,e=$('script[type="text/template"][data-name="'+d+'"]');e.length>0?c(a.Template.Compile(e.html())):a.require(a.Prefix.Template+b+".tmpl",function(b){c(a.Template.Compile(b))})};return function(c,d){var e=this;if("string"==typeof c)return b(e,c,d);var f={};a.forEachAsync(c,function(a,c){b(e,a,function(b){f[a]=b,c()})},function(){d(f)})}}(),h.getComponentClass=function(){var b=function(b,c,d){var e=c.resolveUrl(c.Prefix.Component+b+".js");a.requireComponents(c.getName(),e,function(a){if(!(b in a))throw new Error("getComponentClass: "+b+" is not found in "+e);d(a,!0)})};return function(a,c){var d,f,g=this;if(a.indexOf(":")>=0){var h=a.split(":");d=h[0]||g.getName(),f=h[1]}else d=g.getName(),f=a;d!==g.getName()?e(d,function(a){a.getComponentClass(f,c)}):g.asyncCall(f,b,g,function(a){c(a,f,g)})}}(),g}(),e=function(){var b=a.createAsyncCall(),e=function(a,b,c,e){var f=new d(a,b,c);f.init(function(){e(f)})},g=function(b,c,d){var f=b.split(".").pop();"js"!==f?("/"!==b[b.length-1]&&(b+="/"),e(c,b,null,d)):a.requireConfig(b,function(a){e(c,b,a,d)})};return function(a,d){if(!a)return d(f);if(!(a in c))throw new Error("unknown env name: "+a);var e=c[a];b(e,g,a,d)}}(),f=null;a.createDefaultEnv=function(a,b){if(f)return b(f);var c=new d("","",a);c.init(function(){f=c,b(c)})}}(window.F.__,window),function(a){var b=function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/,c=function(){};return c.extend=function(c){var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]="function"==typeof c[f]&&"function"==typeof d[f]&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,c[f]):c[f];var g=function(){!a&&this.init&&this.init.apply(this,arguments)};return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g.isComponent=!0,g},c}(),c="[data-role=component]",d=function(a){a()},e=function(a,b,c){a.isComponent?c(a):a(b,c)};a.Component=b.extend({init:function(a,b,c){var d=this;d.name=a,d.$container=b,d.F=c,d.fullName=d.F.getName()+":"+a,d.$=d.$container.find.bind(d.$container);var e=d.$container.data("display");e&&d.$container.css("display",e),d.$container.on("destroyed",d.unload.bind(d)),d.rendered=!1,d.subscribeList={},d.earlyRecieved=[],d.templateName=d.templateName||d.name,"string"==typeof d.template&&(d.template=d.F.Template.Compile(d.template));var f=d.Public||{};for(var g in f)!function(a,b){d.subscribe(a,function(a,c,e){b.bind(d)(c,e)})}(d.fullName+"."+g,f[g])},call:function(a,b){a.indexOf(":")<0&&(a=this.F.getName()+":"+a),this.publish(a,b,this)},load:function(a,b){var c=this;a=a||{},c.getData(function(d,e){c.getTemplate(function(){c.render(d,e,function(){c.afterRender(function(){c.rendered=!0,c.myselfLoaded(function(){c.loadChildren(function(){c.allLoaded(function(){console.timeEnd(c.fullName),b&&b()},a)},a)},a)},a)},a)},a)},a)},getData:d,getTemplate:function(a){var b=this;return b.template?a():void b.F.getTemplate(b.templateName||b.name,function(c){b.template=c,a()})},render:function(a,b,c){var d=this.F.Template.Render(this.template,a,b);this.$container.html(d),c()},afterRender:d,myselfLoaded:function(a){for(;this.earlyRecieved.length>0;)this.earlyRecieved.pop()();a()},loadChildren:function(b,d){var f=this,g=f.$(c),h=g.length;return h?void a.forEachAsync(g,function(a,b){var c=$(a),g=c.data("name");f.F.getComponentClass(g,function(a,f,g){e(a,g,function(a){if(!a.isComponent)throw new Error("unexpected component class: "+g.getName()+":"+f);var e=new a(f,c,g);e.load(d,b)})})},function(){b&&b()}):void(b&&b())},allLoaded:d,unload:function(){this.unsubscribe()},require:function(a,b,c){this.F.require(a,b,c)},publish:function(b,c){a.Pubsub.publish(b,c,this)},subscribe:function(b,c){var d=this;d.subscribeList[b]=a.Pubsub.subscribe(b,function(a,b,e){d.rendered?c(a,b,e):d.earlyRecieved.push(function(){c(a,b,e)})})},unsubscribe:function(b){if(b)b in this.subscribeList&&a.Pubsub.unsubscribe(b,this.subscribeList[b]);else for(var c in this.subscribeList)a.Pubsub.unsubscribe(c,this.subscribeList[c])}})}(window.F.__);
//# sourceMappingURL=fractal.min.js.map